{{ define "title" }} {{ .UI.Base.Title }} {{ end }}
{{ define "description" }} {{ .UI.Base.Description }} {{ end }}
{{ define "view" }}
<main>
  <div class="section">
    <h1 class="title is-1 is-size-3-mobile">{{ .UI.Base.Title }}</h1>
    <h3 class="title is-3 is-size-5-mobile">{{ .UI.Base.Description }}</h3>
    <h3 class="title is-3 is-size-5-mobile">{{ .RecipesCount }}</h3>
    {{ template "filter" . }}
  </div>
  <div class="section">
    <div class="columns is-multiline">
      {{ range $i, $recipe := .Recipes }}
      <div class="column is-6">
        {{ template "recipe-card" $recipe }}
      </div>
      {{ end }}
    </div>
  </div>
</main>
{{ end }}

{{ define "recipe-card" }}
<section class="card has-equal-height">
  <div class="card-content">
    <p class="title is-5 is-size-5-mobile mb-2"><a href="/recipe/{{ .Slug }}">{{ .Name }}</a></p>
    <p class="subtitle is-6 is-size-6-mobile m-0">{{ .Description }}</p>
    {{ template "tags" . }}
  </div>
  <div class="card-footer">
    <p class="card-footer-item" title="Rating">
      <span class="icon-text">
        <span class="icon"><i class="bi bi-star-fill"></i></span>
        <span><b>{{printf "%.1f" .Rating}}</b></span>
      </span>
    </p>
    <p class="card-footer-item" title="Average duration">
      <span class="icon-text">
        <span class="icon"><i class="bi bi-clock"></i></span>
        <span><b>{{ FormatDuration .Time }}</b></span>
      </span>
    </p>
    <p class="card-footer-item" title="Servings">
      <span class="icon-text">
        <span class="icon"><i class="bi bi-ui-checks"></i></span>
        <span><b>{{ .Servings }}</b></span>
      </span>
    </p>
  </div>
</section>
{{ end }}

{{ define "tags" }}
<div class="block">
  {{ range .Tags }}
  <button class='button {{ template "tag-button-style" . }} is-rounded is-small mr-2 mb-1'>
    <b>{{ .Group }}:{{ .Name }}</b>
  </button>
  {{ end }}
</div>
{{ end }}

{{ define "tag-button-style" }}
{{ if eq .Group "theme" }}
is-primary
{{ end }}
{{ if eq .Group "len" }}
is-success
{{ end }}
{{ if eq .Group "feature" }}
is-info
{{ end }}
{{ end }}

{{ define "filter" }}
<div class="block">
  <!-- Tags Filter Form -->
  <form class="my-4" id="tags-filter-form" live-change="tags-filter-form-change" live-submit="tags-filter-form-submit">
    <div class="field has-addons">
      <p class="control">
        <span class="select">
          <select name="searchType">
            <option value="include">{{ .UI.Recipe.Filter.Include }}</option>
            <option value="exclude">{{ .UI.Recipe.Filter.Exclude }}</option>
          </select>
        </span>
      </p>
      <p class="control is-expanded">
        <input class="input" type="search" name="value" list="tags" placeholder="{{ .UI.Recipe.Tags }}">
        <datalist id="tags">
          {{ range $tag := .Tags }}
          <option value="{{ $tag.Name }}">{{ $tag.Group }}:{{ $tag.Name }}</option>
          {{ end }}
        </datalist>
      </p>
      <p class="control">
        <button class="button">
          {{ .UI.Recipe.Filter.Add }}
        </button>
      </p>
    </div>
  </form>
  <!-- Ingredients Filter Form -->
  <form class="my-4" id="ingredients-filter-form" live-change="ingredients-filter-form-change"
    live-submit="ingredients-filter-form-submit">
    <div class="field has-addons">
      <p class="control">
        <span class="select">
          <select name="searchType">
            <option value="include">{{ .UI.Recipe.Filter.Include }}</option>
            <option value="exclude">{{ .UI.Recipe.Filter.Exclude }}</option>
          </select>
        </span>
      </p>
      <p class="control is-expanded">
        <input class="input" type="search" name="value" list="ingredients" placeholder="{{ .UI.Recipe.Ingredients }}">
        <datalist id="ingredients">
          {{ range $ingredient := .Ingredients }}
          <option value="{{ $ingredient.Product.Name }}">{{ $ingredient.Product.Name }}</option>
          {{ end }}
        </datalist>
      </p>
      <p class="control">
        <button class="button">
          {{ .UI.Recipe.Filter.Add }}
        </button>
      </p>
    </div>
  </form>
  <!-- Equipment Filter Form -->
  <form class="my-4" id="equipment-filter-form" live-change="equipment-filter-form-change"
    live-submit="equipment-filter-form-submit">
    <div class="field has-addons">
      <p class="control">
        <span class="select">
          <select name="searchType">
            <option value="include">{{ .UI.Recipe.Filter.Include }}</option>
            <option value="exclude">{{ .UI.Recipe.Filter.Exclude }}</option>
          </select>
        </span>
      </p>
      <p class="control is-expanded">
        <input class="input" type="search" name="value" list="equipment" placeholder="{{ .UI.Recipe.Equipment }}">
        <datalist id="equipment">
          {{ range $item := .Equipment }}
          <option value="{{ $item.Name }}">{{ $item.Name }}</option>
          {{ end }}
        </datalist>
      </p>
      <p class="control">
        <button class="button">
          {{ .UI.Recipe.Filter.Add }}
        </button>
      </p>
    </div>
  </form>
</div>
<div class="buttons is-right">
  <button live-click="filter-clear" class="button is-primary is-outlined">{{ .UI.Recipe.Filter.Clear }}</button>
  <button live-click="filter-apply" class="button is-primary">{{ .UI.Recipe.Filter.Apply }}</button>
</div>
<div class="block">
  {{ .Filter }}
</div>
{{ end }}
